import{_ as s,c as a,o as n,a as e}from"./app.156a1fab.js";const d=JSON.parse('{"title":"[WIP] Wallet Interaction","description":"","frontmatter":{},"headers":[{"level":2,"title":"The API","slug":"the-api","link":"#the-api","children":[]},{"level":2,"title":"Step. 1: Check wallet presence","slug":"step-1-check-wallet-presence","link":"#step-1-check-wallet-presence","children":[]},{"level":2,"title":"Step. 2: Request access","slug":"step-2-request-access","link":"#step-2-request-access","children":[]},{"level":2,"title":"Step. 3: Interact with the wallet","slug":"step-3-interact-with-the-wallet","link":"#step-3-interact-with-the-wallet","children":[{"level":3,"title":"Get balance","slug":"get-balance","link":"#get-balance","children":[]},{"level":3,"title":"Get inputs","slug":"get-inputs","link":"#get-inputs","children":[]},{"level":3,"title":"Get the current height","slug":"get-the-current-height","link":"#get-the-current-height","children":[]},{"level":3,"title":"Get ask for a transaction signature","slug":"get-ask-for-a-transaction-signature","link":"#get-ask-for-a-transaction-signature","children":[]},{"level":3,"title":"Submit a transaction to the blockchain","slug":"submit-a-transaction-to-the-blockchain","link":"#submit-a-transaction-to-the-blockchain","children":[]}]}],"relativePath":"guide/wallet-interaction.md","lastUpdated":1670464786000}'),l={name:"guide/wallet-interaction.md"},o=e(`<h1 id="wip-wallet-interaction" tabindex="-1">[WIP] Wallet Interaction <a class="header-anchor" href="#wip-wallet-interaction" aria-hidden="true">#</a></h1><p>One of the most common ways to interact with wallets, and consequently the blockchain, on Ergo Platform is thought EIP-12 protocol \u2013also known as dApp Connector. That&#39;s the main protocol of extension wallets like Nautilus or SAFEW.</p><h2 id="the-api" tabindex="-1">The API <a class="header-anchor" href="#the-api" aria-hidden="true">#</a></h2><p>EIP-12 API is divided in two parts, as follows:</p><ul><li><strong>Connection API</strong>: responsible for connection requesting and checking.</li><li><strong>Ergo API</strong>: responsible for actual wallet interaction, such as fetch balance, request transaction signatures, <em>et cetera</em>.</li></ul><p>EIP-12 compatible browser wallets on Ergo automatically inject <strong>Connection API</strong> into every active, page so that any JavaScript API can call it directly thought the <code>ergoConnector</code> object.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>All EIP-12 methods are asynchronous, which means they will return a <code>Promise</code>. So you need to use <code>await</code> keyword or <code>Promise.then()</code> method to call any of them.</p></div><h2 id="step-1-check-wallet-presence" tabindex="-1">Step. 1: Check wallet presence <a class="header-anchor" href="#step-1-check-wallet-presence" aria-hidden="true">#</a></h2><p>To check if the user has a EIP-12 wallet installed and running you can check for the presence of <code>ergoConnector</code> object and then fot the desired wallet.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki has-focused-lines"><code><span class="line has-focus"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (ergoConnector) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// check if Connection API is injected </span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line has-focus"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">ergoConnector</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nautilus</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// check if Nautilus Wallet available </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Nautilus Wallet is ready to use</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">ergoConnector</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">safew</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// check if SAFEW Wallet available </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SAFEW Wallet is ready to use</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">No wallet available</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="step-2-request-access" tabindex="-1">Step. 2: Request access <a class="header-anchor" href="#step-2-request-access" aria-hidden="true">#</a></h2><p>In order to interact with the user&#39;s wallet you first need to request wallet access. From now on Nautilus Wallet will be used by default on examples.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki has-focused-lines"><code><span class="line has-focus"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> connected </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> ergoConnector</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nautilus</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">connect</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (connected) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Connected!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Not connected!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>When you call <code>ergoConnector.nautilus.connect()</code> a wallet window will pop-up asking for the user to allow access for the selected wallet. If user rejects it will return <code>false</code>, otherwise it will return <code>true</code> and inject the <strong>Ergo API</strong>, so that the <code>ergo</code> object will be available for use.</p><h2 id="step-3-interact-with-the-wallet" tabindex="-1">Step. 3: Interact with the wallet <a class="header-anchor" href="#step-3-interact-with-the-wallet" aria-hidden="true">#</a></h2><p>Now that you have access to the Ergo API you can interact with the connected wallet.</p><h3 id="get-balance" tabindex="-1">Get balance <a class="header-anchor" href="#get-balance" aria-hidden="true">#</a></h3><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// get only ERG balance</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ergBalance </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> ergo</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_balance</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// get balance for a specific token</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sigUsdBalance </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> ergo</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_balance</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">03faf2cb329f2e90d6d23b58d91bbb6c046aa143261cc21f52fbe2824bfcbf04</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// get balance for all assets owned by the connected wallet</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> tokenBalance </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> ergo</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_balance</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">all</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="get-inputs" tabindex="-1">Get inputs <a class="header-anchor" href="#get-inputs" aria-hidden="true">#</a></h3><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> inputs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> ergo</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_utxos</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="get-the-current-height" tabindex="-1">Get the current height <a class="header-anchor" href="#get-the-current-height" aria-hidden="true">#</a></h3><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> height </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> ergo</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_current_height</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="get-ask-for-a-transaction-signature" tabindex="-1">Get ask for a transaction signature <a class="header-anchor" href="#get-ask-for-a-transaction-signature" aria-hidden="true">#</a></h3><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> signedTransaction </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> ergo</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sign_tx</span><span style="color:#A6ACCD;">(unsignedTransaction)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="submit-a-transaction-to-the-blockchain" tabindex="-1">Submit a transaction to the blockchain <a class="header-anchor" href="#submit-a-transaction-to-the-blockchain" aria-hidden="true">#</a></h3><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> transactionId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> ergo</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">submit_tx</span><span style="color:#A6ACCD;">(signedTransaction)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div>`,26),t=[o];function p(c,r,i,y,D,F){return n(),a("div",null,t)}const A=s(l,[["render",p]]);export{d as __pageData,A as default};
